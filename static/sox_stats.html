<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Red Sox Stats</title>
        <style>
            .report-title {
                display: flex;
                align-items: center;
                gap: 1rem;
                flex-wrap: wrap;
                /* allows wrapping if needed */
                margin: 0;
            }

            .report-logo {
                width: 5.25rem;
                height: auto;
                flex: 0 0 auto;
            }

            .report-text {
                line-height: 1.1;
            }

            /* Mobile: stack and center */
            @media (max-width: 480px) {
                .report-title {
                    flex-direction: column;
                    text-align: center;
                    gap: 0.5rem;
                }

                .report-logo {
                    width: 4rem;
                    /* slightly smaller on phones */
                }
            }

            table {
                border-collapse: collapse;
                margin: 1rem auto
            }

            th,
            td {
                border: 1px solid black;
                padding: 0.4rem 0.8rem;
                text-align: center;
                color: white
            }

            th {
                background: #2da35c;
            }

            td.left {
                text-align: left;
            }

            body {
                font-family: Arial, sans-serif;
                padding: 20px;
                line-height: 1.5;
                background-color: #d5eadd;
            }

            h1 {
                color: #1045BA;
            }

            h2 {
                color: firebrick;
                margin: 1rem auto;
                text-align: center;
            }

            .thClickable {
                background-color: #2da35c;
                cursor: pointer;
            }

            tr:nth-child(odd) {
                background-color: #6fca74;
            }

            tr:nth-child(even) {
                background-color: #2da35c
            }

            a {
                text-decoration: underline;
                color: gold
            }
        </style>
    </head>
    <body>
        <h1 class="report-title">
            <img src="/static/Wally with clipboard.png"
                 alt="Wally the Red Sox Mascot"
                 class="report-logo" />
            <span class="report-text">
    Red Sox Daily Report for <span id="currentDate"></span>
            </span>
        </h1>
        <h2>âš¾ Red Sox Game Info</h2>
        <div id="status">Loading...</div>
        <div id="summary"
             style="display:none;">
            <p>Game Summary</p>
        </div>
        <div id="standings"
             style="display:none;">
            <h2>ðŸ“Š Standings (AL East)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>W</th>
                        <th>L</th>
                        <th>GB</th>
                        <th>Elim</th>
                        <th>WC Rank</th>
                        <th>WC GB</th>
                        <th>WC Elim</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div id="transactions"
             style="display:none;">
            <h2>ðŸ“‹ Recent Transactions</h2>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Player</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div id="roster"
             style="display:none;">
            <h2>ðŸ§¢ Current Roster (Sortable)</h2>
            <table id="rosterTable">
                <thead>
                    <tr>
                        <th class='thClickable'
                            onclick="sortTable(0)">Name</th>
                        <th class='thClickable'
                            onclick="sortTable(1)">Position</th>
                        <th class='thClickable'
                            onclick="sortTable(2)">Number</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <script>
            function sortTable(n) {
                var table = document.getElementById("rosterTable");
                var switching = true;
                var dir = "asc";
                var switchcount = 0;

                while (switching) {
                    switching = false;
                    var rows = table.rows;

                    for (var i = 1; i < rows.length - 1; i++) {
                        var shouldSwitch = false;
                        var x = rows[i].getElementsByTagName("TD")[n];
                        var y = rows[i + 1].getElementsByTagName("TD")[n];

                        if (dir === "asc" && x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                        if (dir === "desc" && x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    }

                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                        switchcount++;
                    } else {
                        if (switchcount === 0 && dir === "asc") {
                            dir = "desc";
                            switching = true;
                        }
                    }
                }
            }
            let currentDate = document.querySelector("#currentDate");
            const date = new Date();
            currentDate.textContent = date.toLocaleString("en-US", {
                timeZone: "America/Chicago",
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
            });
            async function loadSched() {
                try {
                    const res = await fetch("/api/redsox_sched");
                    if (!res.ok) throw new Error("Network response was not ok");
                    const data = await res.json();

                    document.getElementById("summary").textContent = data.summary;

                    document.getElementById("status").style.display = "none";
                    document.getElementById("summary").style.display = "block";
                } catch (err) {
                    document.getElementById("status").textContent = "Error loading stats.";
                    console.error(err);
                }
            }
            async function loadStandings() {
                try {
                    const res = await fetch("/api/redsox_standings");
                    if (!res.ok) throw new Error("Network response was not ok");
                    const records = await res.json();

                    const tbody = document.querySelector("#standings tbody");
                    tbody.innerHTML = "";

                    for (const r of records) {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                    <td>${r.rank}</td>
                    <td class="left">${r.team}</td>
                    <td>${r.wins}</td>
                    <td>${r.losses}</td>
                    <td>${r.gb}</td>
                    <td>${r.elim}</td>
                    <td>${r.wc_rank}</td>
                    <td>${r.wc_gb}</td>
                    <td>${r.wc_elim}</td>
                `;
                        tbody.appendChild(tr);
                    }

                    document.getElementById("status").style.display = "none";
                    document.getElementById("standings").style.display = "block";
                } catch (err) {
                    document.getElementById("status").textContent = "Error loading stats.";
                    console.error(err);
                }
            }
            async function loadTransactions() {
                try {
                    const res = await fetch("/api/redsox_transactions");
                    if (!res.ok) throw new Error("Network response was not ok");
                    const records = await res.json();

                    const tbody = document.querySelector("#transactions tbody");
                    tbody.innerHTML = "";

                    for (const r of records) {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                    <td>${r.date}</td>
                    <td class="left">${r.description}</td>
                    <td><a href='${r.formatted_link}' target='_blank'>${r.player}</a></td>
                `;
                        tbody.appendChild(tr);
                    }


                    document.getElementById("status").style.display = "none";
                    document.getElementById("transactions").style.display = "block";
                } catch (err) {
                    document.getElementById("status").textContent = "Error loading stats.";
                    console.error(err);
                }
            }
            async function loadRoster() {
                try {
                    const res = await fetch("/api/redsox_roster");
                    if (!res.ok) throw new Error("Network response was not ok");
                    const records = await res.json();

                    const tbody = document.querySelector("#roster tbody");
                    tbody.innerHTML = "";

                    for (const r of records) {
                        const tr = document.createElement("tr");
                        tr.innerHTML = `
                    <td class="left">${r.name}</td>
                    <td class="left">${r.position}</td>
                    <td>${r.number}</td>
                `;
                        tbody.appendChild(tr);
                    }


                    document.getElementById("status").style.display = "none";
                    document.getElementById("roster").style.display = "block";
                } catch (err) {
                    document.getElementById("status").textContent = "Error loading stats.";
                    console.error(err);
                }
            }

            // Load once on page load

            loadSched();
            loadStandings();
            loadTransactions();
            loadRoster();

            // Optional: refresh every 60 seconds
            // setInterval(loadStats, 60000);
        </script>
    </body>
</html>